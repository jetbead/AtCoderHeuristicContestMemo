# 統計モデリング

- 推定系の問題などで、得られたデータから推定を行う方法

## 多変数正規分布(多変量ガウス分布)

- 正規分布を仮定して、要素数分の次元の正規分布でモデリング
  - 多次元(多変量)の場合、平均や分散などはベクトルや行列として扱う
- 条件付き正規分布
  - 2つの変数集合の同時分布が正規分布のとき、一方の変数集合が与えられたときのもう一方の集合の条件付き分布も正規分布になる
    - どちらの変数集合の周辺分布も正規分布
  - ある隠れ変数と観測された値との関係がわかっている場合、観測された値が与えられた場合の隠れ変数の平均、分散が求められる
    - PRML2.3.1〜2.3.3
    - https://speakerdeck.com/yos1up/ahc003-2wei-jie-fa?slide=10

```python
# 適当な例: xが正規分布に従う確率変数で、それらの線形変換後の値yだけ観測できるとき、各xの分布を推定
#  (x1,x2,x3): 平均5、平均3、平均0、分散は4の正規分布に従う
#  (y1,y2,y3): y1=x1+x3, y2=x1+x2, y3=x1+x2+x3の関係になっている観測できる値
import numpy as np

# xとyとの関係(y=Ax+b)
A = np.array([
    [1, 0, 1],
    [1, 1, 0],
    [1, 1, 1]
])
b = np.zeros(3)

# 観測yでの精度行列L
sgm = np.zeros((3,3))
sgm[0,0] = sgm[1,1] = 8.0
sgm[2,2] = 12.0
L = np.linalg.inv(sgm)

# 観測&ベイズ更新
results = []
mu = np.zeros(3) # 平均
lmd = np.ones((3,3)) * 1e-9 # 精度行列(分散の逆行列)
for i in range(1000):
    # 正規乱数
    x1 = np.random.normal(5, 4)
    x2 = np.random.normal(3, 4)
    x3 = np.random.normal(0, 4)
    # 観測できる値
    y1 = x1 + x3
    y2 = x1 + x2
    y3 = x1 + x2 + x3
    # ベイズ更新
    cov = np.linalg.inv(lmd + (A.T @ L @ A))
    E = cov @ ((A.T @ L @ (np.array([y1,y2, y3]) - b).T) + (lmd @ mu))
    mu = E
    lmd = np.linalg.inv(cov)
    results.append(E)
```

### 非正規なデータへの正規分布仮定

- データが正規分布に従っているとは言えなくても、標本平均の分布は正規分布に近い
  - 平均を推定しようとしている場合などはうまくいく
  - 逆に、他の統計量を推定しようとする場合はよくない可能性がある

### ラプラス近似

## ベイズ推定

- 例えば、平均値のわからない(分散はわかる)正規分布に従って生成されたのがわかっているデータが与えられたとき、可能性の高い平均値を求めたい
- 平均値を確率分布(事前分布)として考えて、ベイズの定理でデータ点を使って分布を更新(ベイズアップデート)し、事後分布を得る
- 事後分布は事前分布と同じとは限らないが、同じになるようなケース(共役事前分布)では、各パラメータの更新式だけになる
- 事後分布がいい感じにならない場合は、事後分布からサンプリングして、それを使って代表値(要約値)などを求める(MCMC)、など

- https://platinum-prog.hatenablog.com/entry/2023/05/20/231200

### 共役事前分布

- 正規分布
  - 分散(精度)既知: 正規分布
  - 平均既知: ウィシャート分布、逆ウィシャート分布
    - 逆ガンマ分布
  - 平均、分散未知: 正規-ウィシャート分布
- 多項分布
  - ディリクレ分布
    - https://jetbead.hatenablog.com/entry/20120216/1329408665

### MCMC

#### ギブスサンプリング


## カルマンフィルタ


## ベイズ最適化

- https://www.slideshare.net/issei_sato/bayesian-optimization


## 問題

- [AHC003](../ContestMemo/ahc003.md)
- [AHC016](../ContestMemo/ahc016.md)
- https://yukicoder.me/problems/no/5006
  - https://twitter.com/square10011/status/1535911569607245824

