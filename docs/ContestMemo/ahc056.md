---
title: AHC056(HTTF)
---

# HACK TO THE FUTURE 2026(AHC056)

- https://atcoder.jp/contests/ahc056

<img src="../imgs/ahc056.png" width=300>

## 問題概要

- N\*Nマス(N\=10〜20)の盤面があり、各マスには色を塗ることができる
  - 盤面には壁がある可能性があり、その場合、壁を超えて移動はできない
- 盤面上にはロボットいて、K個の異なる目的地の列と上限ステップ数Tが与えられるので、Tステップ以下ですべての目的地に順番に訪れたい
  - Tは、最短距離で移動したときの総距離をXとして、X〜2\*X
- ロボットは、内部状態を表す変数を1つ持ち、現在のマスの色cと内部状態qから次の行動(A(c,q),S(c,q),D(c,q))を決定する
  - A(c,q): 現在のマスの色をA(c,q)に塗り替える
  - S(c,q): 内部状態をS(c,q)に更新する
  - D(c,q): D(c,q)方向(上下左右)に1マス移動、または、移動しない  
- 必要な色数と内部状態数をC、Qとして、C+Qができるだけ小さくなるような「遷移規則(A(c,q),S(c,q),D(c,q))」と「盤面の色の初期状態」を設計せよ

## 時間

- 240 時間

## 個人的メモ

### CQ表の形

- 遷移規則の色cと内部状態qの表を、仮に「CQ表」と呼ぶことにする
- スコアがC+Qになっているので、CQ表の要素数が最大になるのはC=Q(正方形)になるときで、正方形の方がよさそうに思われる
  - 例えば、C+Q=10だとして、C=1,Q=9だと要素は9個だが、C=5,Q=5なら要素は25個
  - また、正方形と考えた場合、スコアを1点減らすためには、sqrt(C)要素程度減らす必要があるので、結構減らさないとスコアが改善しなそうなことも予想される
- アプローチによっては、同じ内部状態にしたい場合など制約があるので、正方形にならない可能性もある

### 後ろから構築

- 移動経路が決まっている場合、経路の最後から考えると、次の色A(c,q)、内部状態S(c,q)、向きD(c,q)が確定しているので、機械的に決められる
- ここで、割り当てる(c,q)をどうするか？には自由度がある
- 色の割当によっては使いまわしができる可能性があり、スコアが改善しうる
  - qが最終的に0で終わるとは限らないが、適当に他の0以外のものと0を交換すれば良い

### アプローチ

#### 団子解

- コンテストの初期から順位表で同じスコアで固まっているところがあった(順位が団子になっていた)
  - 最終順位だと365位あたり
- 目的地へは最短経路で移動し、マスの移動では、毎回、色と内部状態を切り替える(かつ、使い回さない)
- 最短経路での総距離をXとすると、2\*sqrt(X)ぐらいのスコアになる
- (解説放送) システムテストでは分裂してたみたいで、最終目的地付近での操作をいれるかどうかなどで微妙にスコアに違いがでてたみたい

#### 後ろから構築をビームサーチ

- 後ろから構築する時、割り当てる(c,q)には自由度があるので、「既存の規則を使う」「新規に規則を追加して使う」「CかQを拡張してそれを使う」などで探索
  - 未確定を許して、過去改変的にする感じが良いみたい
  - 評価関数は、C+Qや遠回り具合だけでなく、未確定マスの数やabs(C-Q)なども考慮すると良いみたい
- 単純なビムサだと、盤面とCQ表を持つ必要があって重いので、差分更新ビムサでやる、など
  - (解説放送) mapを永続データ構造(rustはrpdsというライブラリがあるらしい)などで差分を持つなども

#### ベルトコンベア

- 同じ経路を何度も同じ向きで通る場合、同じルールを使い回せる可能性がある
  - たとえば、壁の切れ目付近などは行ったり来たりで同じルートを通りやすい、など
- そこで、ある程度の長さのパスをベルトコンベアと考えて、まず、色固定・向き固定で設置することが考えられる
  - 発展として、状態を変えて訪問ごとに向きを変えたりなども考えることができる
- 向き固定の場合、ベルトコンベアを横切るような経路は取れないので、作るとしてもあまり長いベルトコンベアは作れない可能性がある
- ベルトコンベアの形状や位置などいろいろ探索させたいところだが、全体のターン数が条件を満たすか？などは全目的地について最短経路を計算し直す必要があり、かなり重い
  - また、ベルトコンベアの設置数や利用回数が少ないと、たいしてスコアに影響しないので、見込みがあるか判断しにくい
- 今回は、ベルトコンベアの設置として考えるより、後の「市松模様」や「氷の床」などで考えるのが考えやすく、上位では多かった模様

#### 市松模様

- 盤面を市松模様で考えて、片方を色0固定、もう片方は自由マスと考える
- 色0マスでは、次も色0にしたいので、状態qの方を変えて侵入するようにすると、違う向きに移動できるようにできる
  - 「(0,q)->(0,q,向き)」のようなルール
- 色0マスに目的地がある場合でも、次に動きたい方向になるように内部状態を指定すればよいので、ターン数は増えないような移動ができる
- 移動経路中の半分ぐらいが色0固定マスになって、必要C,Qが抑えられる
  - 最短経路での総距離をXとすると、2\*sqrt(X/2)\=sqrt(2X)ぐらいのスコアにできる

#### 氷の床

- 市松模様の発展形で、盤面のほとんどを色0マスにして、少数のマスを切り替え用に使う
- 移動経路中の多くが色0固定マスになるので、色0の利用率がかなり高くなり、かなりC,Qが抑えられる
- 重要な点として、(市松模様での話と同様に)、あるマスから氷の床へ入るとき「進入方向」「滑る方向」が変えられるので、結構自由度(16パターン)がある
- 切り替えマスの探索
  - 市松模様の場合と違って、ターン数を満たす、できるだけ訪問回数が少なくなるような切り替えマスの配置を見つける必要がある
  - ターン数は、前計算で、全マスについて他のマスまでの距離をBFSで求めておけばO(1)で求められる
  - 切り替えマスの訪問回数が少なくなるような移動は、ダイクストラしたいが、愚直にやると時間がかかるため高速化が必要
    - SIMD/ビット並列などで高速化
    - 移動可能なマスだけでグラフを作ってそれで探索
    - 01BFS
    - 到達可能か？の判定を先にしておく
    - など
- 遷移規則の圧縮
  - 切り替えマスの部分に割り当てる規則はある程度同じものが使い回せる可能性がある
  - 山登り的に圧縮
    - https://blog.oimo.io/2025/11/22/ahc056/
    - https://x.com/itigo_purokonn/status/1990359622470013016
  - UnionFind+ケンペ鎖
    - https://x.com/Shun___PI/status/1990415976442040537
    - https://x.com/Shun___PI/status/1990725120344645644
  - C固定で詰め込み
    - https://qiita.com/tanaka-a/items/bd3f67216f534e904216
  - など
- その他
  - 色0だけでなく色1やそれ以上も固定マスとして使う
    - 複数の役割を用意する(反射、通過、回転)
  - 途中から固定マスにする

#### 最大C,Q固定でビームサーチ

- 目的地数が少なめの時、スコア4とか5のような尋常じゃないスコアが出せていた模様
- 最大C,Q固定で、順方向にビームサーチで探せるらしい
  - https://x.com/erik_kvanli/status/1990389652776190346

## 解説

(50位まで&発言を見つけられた方のみ)

- [AHCラジオ(解説放送)](https://www.youtube.com/watch?v=sbfH3GBd3fM)
- [解説(日本語)](https://atcoder.jp/contests/ahc056/editorial)
- [解説(英語)](https://atcoder.jp/contests/ahc056/editorial?editorialLang=en)

- [saharanさん](https://x.com/shr_pc/status/1990361293623316714)
  - https://x.com/shr_pc/status/1990368424787374298
  - https://x.com/shr_pc/status/1990387240057360839
  - https://x.com/shr_pc/status/1990392626244166143
  - https://x.com/shr_pc/status/1990397267656785925
  - https://x.com/shr_id/status/1992235191788806609
  - https://blog.oimo.io/2025/11/22/ahc056/
- [rhooさん](https://x.com/rho__o/status/1990361545436811309)
  - https://x.com/rho__o/status/1990365652138463436
  - https://x.com/rho__o/status/1990368664949014885
  - https://x.com/rho__o/status/1990369486353097148
  - https://x.com/rho__o/status/1990389886424146414
  - https://x.com/rho__o/status/1990611370983981406
- [montplusaさん](https://x.com/montplusa/status/1990368062219141271)
  - https://x.com/montplusa/status/1990372562484985974
  - https://x.com/montplusa/status/1990374343155839139
  - https://x.com/montplusa/status/1990454440302875005
  - https://x.com/montplusa/status/1990789344177893551
  - https://x.com/montplusa/status/1990795677153309029
- [bowwowforeachさん](https://x.com/bowwowforeach/status/1990753861070696501)
  - https://x.com/bowwowforeach/status/1990755734490132892
- [itigoさん](https://x.com/itigo_purokonn/status/1990359622470013016)
  - https://x.com/itigo_purokonn/status/1990363049279271073
  - https://x.com/itigo_purokonn/status/1990365068966695223
  - https://x.com/itigo_purokonn/status/1990427714059460832
  - https://x.com/itigo_purokonn/status/1990443221823131891
  - https://x.com/itigo_purokonn/status/1991194205478334634
  - https://x.com/itigo_purokonn/status/1991840320666112410
- [Illedanさん](https://x.com/erik_kvanli/status/1990363998831669689)
  - https://x.com/erik_kvanli/status/1990702756680851678
- [yosupoさん](https://x.com/yosupot/status/1990363022414713143)
  - https://x.com/yosupot/status/1990383908786180264
  - https://x.com/yosupot/status/1990388239467745297
- [Shun_PIさん](https://x.com/Shun___PI/status/1990359720079876539)
  - https://x.com/Shun___PI/status/1990361028753064165
  - https://x.com/Shun___PI/status/1990361810919453058
  - https://x.com/Shun___PI/status/1990363409343549452
  - https://x.com/Shun___PI/status/1990369488055980127
  - https://x.com/Shun___PI/status/1990414450252521674
  - https://x.com/Shun___PI/status/1990415976442040537
  - https://x.com/Shun___PI/status/1990418885481201678
  - https://x.com/Shun___PI/status/1990445473711464557
  - https://x.com/Shun___PI/status/1990725120344645644
- [tetra4さん](https://x.com/tetra4_cp/status/1990365593976144169)
  - https://x.com/tetra4_cp/status/1990371974691078281
  - https://x.com/tetra4_cp/status/1990360813463638059
  - https://note.com/tetra4_cp/n/n6be697ae0f1d
- [Jinapettoさん](https://x.com/Jinapetto/status/1990361405728711123)
  - https://x.com/Jinapetto/status/1990363138643161221
  - https://x.com/Jinapetto/status/1990365014197502274
  - https://x.com/Jinapetto/status/1990365853872005332
  - https://x.com/Jinapetto/status/1990369447887175972
- [rabotさん](https://x.com/tanaka_a8/status/1990365630902804534)
  - https://x.com/tanaka_a8/status/1990383243494117545
  - https://x.com/tanaka_a8/status/1990794614522180000
  - https://x.com/tanaka_a8/status/1991153502391820499
  - https://x.com/tanaka_a8/status/1992602940109095155
  - https://qiita.com/tanaka-a/items/bd3f67216f534e904216
- [ymatsuxさん](https://x.com/ymatsux_ac/status/1990360526170579175)
  - https://x.com/ymatsux_ac/status/1990361821073867168
  - https://x.com/ymatsux_ac/status/1990364907645386972
  - https://x.com/ymatsux_ac/status/1990376334665900455
  - https://x.com/ymatsux_ac/status/1990798292004061369
- [PrussianBlueさん](https://x.com/prussian_coder/status/1990363511072166131)
  - https://x.com/prussian_coder/status/1990389538363949279
  - https://prussianblue.hatenadiary.jp/entry/2025/11/20/002256
- [besukohuさん](https://x.com/besukohu/status/1990359991677812835)
- [Ang107さん](https://x.com/Ang_kyopro/status/1990359346283491441)
  - https://x.com/Ang_kyopro/status/1990360278509502971
  - https://x.com/Ang_kyopro/status/1990361403396661271
  - https://x.com/Ang_kyopro/status/1990362756051288320
  - https://x.com/Ang_kyopro/status/1990364345981919722
  - https://x.com/Ang_kyopro/status/1990364593680773195
  - https://x.com/Ang_kyopro/status/1990372343986987065
  - https://x.com/Ang_kyopro/status/1990373350104043577
  - https://x.com/Ang_kyopro/status/1990377124319170663
  - https://x.com/Ang_kyopro/status/1990398962868637893
  - https://x.com/Ang_kyopro/status/1990513693197820199
- [uta_cccさん](https://x.com/uta_cccc/status/1990361027159249003)
  - https://x.com/uta_cccc/status/1990379191930634488
  - https://x.com/uta_cccc/status/1990433091350118456
  - https://utac.hateblo.jp/entry/2025/11/18/011105
- [satoyukiさん](https://x.com/tomatokiraida52/status/1990368692786606267)
- [syndromeさん](https://x.com/syndro_6/status/1990363997338771670)
- [physics0523さん](https://x.com/butsurizuki/status/1990369975731904679)
  - https://x.com/butsurizuki/status/1990371306123251954
  - https://kcpc.hatenablog.com/entry/2025/11/22/191847
- [MathGorillaさん](https://x.com/MathGorilla_cp/status/1990364004401975460)
  - https://x.com/MathGorilla_cp/status/1990365499235213765
  - https://x.com/MathGorilla_cp/status/1990370258667061362
  - https://x.com/MathGorilla_cp/status/1990617976845083133
- [mech_39さん](https://x.com/fuwaorune/status/1990365127821201744)
  - https://x.com/fuwaorune/status/1990618048680899076
- [KKT89さん](https://x.com/_KKT89/status/1990362994380013904)
- [G4NP0Nさん](https://x.com/G4NP0N/status/1990361717302493591)
  - https://x.com/G4NP0N/status/1990362471551631492
  - https://x.com/G4NP0N/status/1990363085601915020
  - https://x.com/G4NP0N/status/1990363610242273594
  - https://x.com/G4NP0N/status/1990359547878498304
  - https://x.com/G4NP0N/status/1990366082935423394
  - https://x.com/G4NP0N/status/1990367221336645828
  - https://x.com/G4NP0N/status/1990370038499668190
  - https://x.com/G4NP0N/status/1990370132255011033
  - https://x.com/G4NP0N/status/1990374931759325472
  - https://x.com/G4NP0N/status/1990375141419934050
  - https://x.com/G4NP0N/status/1990375504952877370
  - https://x.com/G4NP0N/status/1990434279382229461
  - https://x.com/G4NP0N/status/1990435848249073979
  - https://x.com/G4NP0N/status/1990620493163249968
  - https://x.com/G4NP0N/status/1990621101685420198
- [bresoさん](https://x.com/Carbon_so6/status/1990360151493411276)
  - https://x.com/Carbon_so6/status/1990368600222564471
  - https://x.com/Carbon_so6/status/1990390375748399287
- [bird01さん](https://x.com/bird0148677302/status/1990368576621137991)
- [kenchoさん](https://x.com/border_of_ymg/status/1990364636949172509)
  - https://x.com/border_of_ymg/status/1990365882292605186
  - https://x.com/border_of_ymg/status/1990367406414590282
  - https://x.com/border_of_ymg/status/1990367879817208230
  - https://x.com/border_of_ymg/status/1990370163129290869
  - https://x.com/border_of_ymg/status/1990361038290870552
  - https://x.com/border_of_ymg/status/1990372259257856424
  - https://x.com/border_of_ymg/status/1990381904370311236
  - https://x.com/border_of_ymg/status/1990609280643584255
- [hiro116sさん](https://x.com/hiro116s/status/1990359869510267081)
  - https://x.com/hiro116s/status/1990361137607815485
  - https://x.com/hiro116s/status/1990390004141510723
- [kaz49bzさん](https://x.com/kaz_d37/status/1990381500496490542)
- [yochanさん](https://x.com/yochan_tech/status/1990383492937794045)
- [Moegiさん](https://atcoder.jp/contests/ahc056/editorial/14603)


## Links

- [twitter hashtag AHC056](https://x.com/hashtag/AHC056)
- [twitter search AHC056](https://x.com/search?q=AHC056)
- [twitter hashtag HTTF](https://x.com/hashtag/httf)
- [wataさん詳細順位表](https://img.atcoder.jp/ahc_standings/index.html?contest=ahc056)
